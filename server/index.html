<!DOCTYPE html>
<html>
  <head>
    <title>TreeSQL</title>
    <style>
      #messages {
        width: 100%;
      }
      #messages tr {
        font-family: monospace;
      }
      tr.source-server {
        background-color: white;
      }
      tr.source-client {
        background-color: lightgreen;
      }
      #command-area {
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>TreeSQL Console</h1>
    <table id="messages" border="1">
      <tr>
        <th>Source</th>
        <th>Message</th>
        <th>Timestamp</th>
      </tr>
    </table>
    <form id="send-form">
      <input type="text" id="command-area" size="100" />
      <button id="send-button">Send</button>
    </form>
    <script>
      const ws = new WebSocket("ws://localhost:9000/ws")
      const messagesTable = document.getElementById('messages');
      const commandArea = document.getElementById('command-area');
      commandArea.focus();
      function addToLog(message, source) {
        const tr = document.createElement('tr');
        tr.className = `source-${source}`
        
        const sourceTd = document.createElement('td');
        sourceTd.innerText = source;
        tr.appendChild(sourceTd);
        
        const td = document.createElement('td');
        td.innerText = message;
        tr.appendChild(td);

        const dateTd = document.createElement('td');
        dateTd.innerText = new Date().toISOString();
        tr.appendChild(dateTd);

        messagesTable.appendChild(tr);
      }
      ws.addEventListener('message', (message) => {
        addToLog(message.data, 'server');
      });
      document.getElementById('send-form').addEventListener('submit', (evt) => {
        evt.preventDefault()
        const command = commandArea.value;
        commandArea.value = '';
        addToLog(command, 'client');
        ws.send(command);
      });
    </script>
  </body>
</html>
